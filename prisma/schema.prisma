// Prisma schema for SSO Oil Shop Displayer
// Database: PostgreSQL with two main tables

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Oils table - stores oil products with bilingual support
model Oil {
  id             Int      @id @default(autoincrement())
  name_en        String   @db.VarChar(255)
  name_my        String   @db.VarChar(255)
  description_en String   @db.Text
  description_my String   @db.Text
  price_per_unit Decimal  @db.Decimal(10, 2)
  unit           String   @default("viss") @db.VarChar(20) // viss, liter, kg
  image_url      String?  @db.VarChar(500)
  is_active      Boolean  @default(true)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  // Relation: sale items that reference this oil
  saleItems      SaleItem[]

  @@map("oils")
}

// Users table - admin authentication
model User {
  id            Int      @id @default(autoincrement())
  username      String   @unique @db.VarChar(100)
  password_hash String   @db.VarChar(255)
  role          String   @default("admin") @db.VarChar(50)
  created_at    DateTime @default(now())

  @@map("users")
}

// ==========================
// Sales tracking (owner-only)
// ==========================

// Type of sale: single oil or mix of multiple oils
enum SaleType {
  SINGLE_OIL
  MIX
}

// High-level sale record (one confirmed transaction)
model Sale {
  id             Int        @id @default(autoincrement())
  created_at     DateTime   @default(now())
  total_amount   Decimal    @db.Decimal(12, 2) // MMK charged
  total_quantity Decimal    @db.Decimal(10, 3) // total quantity in standard unit (e.g. viss)
  sale_type      SaleType
  note           String?    @db.VarChar(255)

  items          SaleItem[]

  @@map("sales")
}

// Per-oil line item within a sale
model SaleItem {
  id                Int      @id @default(autoincrement())
  sale_id           Int
  oil_id            Int
  oil_name_snapshot String   @db.VarChar(255) // oil name at time of sale
  quantity          Decimal  @db.Decimal(10, 3) // quantity for this oil in standard unit
  line_amount       Decimal  @db.Decimal(12, 2) // MMK for this line

  sale              Sale     @relation(fields: [sale_id], references: [id], onDelete: Cascade)
  oil               Oil      @relation(fields: [oil_id], references: [id])

  @@map("sale_items")
}

